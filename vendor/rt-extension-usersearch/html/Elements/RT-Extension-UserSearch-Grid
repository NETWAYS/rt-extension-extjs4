<table class="queue-summary" width="100%" cellspacing="0" cellpadding="1">
<tr>
	<th class="collection-as-table">Users</th>
% for my $status (@StatusList) {
	<th class="collection-as-table"><%loc($status)%></th>
% }
	<th class="collection-as-table"><&|/l&>total</&></th>
</tr>
% for my $user(@u) {
%   #RT::Logger->debug("UserSearch: Processing user ". $user->Name);
%   $i++;
%   my $baseLink = RT->Config->Get('WebPath'). "/Search/Results.html?Query=Owner='". $user->Name. "'";
	<tr class="<% $i%2 ? 'oddline' : 'evenline' %>">
		<td><a href="<%$baseLink|n%><%$totalCond|n%>"><%$user->Name%></a></td>
%   my $rowsum = 0;
%   for my $status (@StatusList) {
%     if ($data->{$user->Name}->{$status} && $data->{$user->Name}->{$status} > 0) {
%       $rowsum += $data->{$user->Name}->{$status};
%     }
		<td align="right">
			<a href="<%$baseLink|n%> and Status='<%$status%>'">
				<% $data->{$user->Name}->{$status} || '-' %>
			</a>
		</td>
%   }
		<td align="right">
			<a href="<%$baseLink|n%><%$totalCond|n%>">
				<% $rowsum > 0 ? $rowsum : '-' %>
			</a>
		</td>
	</tr>
% }
</table>

<%init>

	use RT::Report::Tickets;
	my $report = RT::Report::Tickets->new( RT->SystemUser );
	$Users->OrderBy( ALIAS => 'main', FIELD => 'Name', ORDER => 'ASC' );
	my @u = @{ $Users->ItemsArrayRef };

	my $query = join(' OR ',  map { "Owner = ".$_->Id } @u);
	
	my $data = {};
	my $state = {};
	my $i=0;

	$report->SetupGroupings( Query => $query, GroupBy => [qw(Status Owner)] );

	#RT::Logger->debug("UserSearch report results: " . Dumper($report));
	#RT::Logger->debug("UserSearch users: ". join(' ',  map { "Name: ".$_->Name } @u));

	while(my $entry = $report->Next()) {
		#RT::Logger->debug("UserSearch: " . Dumper($entry));
		#$m->out('<pre>' . Dumper($entry). '</pre>');
		$data->{$entry->__Value('col1')}->{$entry->__Value('status')} = $entry->__Value('id');
		$state->{$entry->__Value('Status')} = 1;
	}
	my $totalCond = ' AND ('. join(' OR ', map {"Status='$_'"} @StatusList). ')';

</%init>
<%args>
	$Users => undef
	@StatusList => ()
</%args>
