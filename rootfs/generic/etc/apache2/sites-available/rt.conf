KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 100

<IfModule mod_ssl.c>
    <VirtualHost _default_:443>
        LogLevel warn
        ServerAdmin webmaster@localhost
        ErrorLog ${APACHE_LOG_DIR}/ssl-rt-error.log
        CustomLog ${APACHE_LOG_DIR}/ssl-rt-access.log combined
        SSLEngine on
        SSLCertificateFile      /etc/apache2/ssl/cert.pem
        SSLCertificateChainFile /etc/apache2/ssl/ca.pem
        SSLCertificateKeyFile   /etc/apache2/ssl/key.pem

        RedirectMatch ^/netways/?(.*?)$ https://rt.netways.de/$1

        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                SSLOptions +StdEnvVars
        </FilesMatch>
        <Directory /usr/lib/cgi-bin>
                SSLOptions +StdEnvVars
        </Directory>
        BrowserMatch "MSIE [2-6]" \
                nokeepalive ssl-unclean-shutdown \
                downgrade-1.0 force-response-1.0
        # MSIE 7 and newer should be able to use keepalive
        BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
        AddDefaultCharset UTF-8

        <IfModule mod_expires.c>
            ExpiresActive on

            ExpiresByType image/jpg "access plus 60 days"
            ExpiresByType image/png "access plus 60 days"
            ExpiresByType image/gif "access plus 60 days"
            ExpiresByType image/jpeg "access plus 60 days"

            ExpiresByType text/css "access plus 1 days"

            ExpiresByType image/x-icon "access plus 1 month"

            ExpiresByType application/pdf "access plus 1 month"
            ExpiresByType audio/x-wav "access plus 1 month"
            ExpiresByType audio/mpeg "access plus 1 month"
            ExpiresByType video/mpeg "access plus 1 month"
            ExpiresByType video/mp4 "access plus 1 month"
            ExpiresByType video/quicktime "access plus 1 month"
            ExpiresByType video/x-ms-wmv "access plus 1 month"
            ExpiresByType application/x-shockwave-flash "access 1 month"

            ExpiresByType text/javascript "access plus 1 week"
            ExpiresByType application/x-javascript "access plus 1 week"
            ExpiresByType application/javascript "access plus 1 week"
        </IfModule>

        <ifmodule mod_headers.c>
            <filesmatch "\\.(ico|jpe?g|png|gif|swf)$">
                Header set Cache-Control "max-age=2592000, public"
            </filesmatch>
            <filesmatch "\\.(css)$">
                Header set Cache-Control "max-age=604800, public"
            </filesmatch>
            <filesmatch "\\.(js)$">
                Header set Cache-Control "max-age=216000, private"
            </filesmatch>
        </ifmodule>

        DocumentRoot "/opt/rt4/share/html"
        <Location />
            Require all granted

            SetHandler modperl
            PerlResponseHandler Plack::Handler::Apache2
            PerlSetVar psgi_app /opt/rt4/sbin/rt-server

            # Disabled because of RT::Authen::ExternalAuth
            # --------------------------------------------
            # AuthType Basic
            # AuthName "RT"
            # AuthBasicProvider ldap
            # AuthLDAPRemoteUserIsDN off
            # AuthLDAPURL "ldap://int.netways.de/dc=INT,dc=NETWAYS,dc=DE?samAccountName?sub?(objectCategory=person)(ObjectClass=User)"
            # AuthLDAPBindDN netways-http@INT.NETWAYS.DE
            # AuthLDAPBindPassword Zuriep2w
            # require ldap-group CN=net-rt-auth-HTTP,OU=AuthGroups,OU=NETWAYS,OU=NETRZ,OU=NETWAYS,DC=int,DC=netways,DC=de
            # --------------------------------------------
        </Location>
        <Perl>
            use Plack::Handler::Apache2;
            Plack::Handler::Apache2->preload("/opt/rt4/sbin/rt-server");
        </Perl>
    </VirtualHost>
</IfModule>

<VirtualHost _default_:80>
    LogLevel warn
    ServerAdmin webmaster@localhost
    ErrorLog ${APACHE_LOG_DIR}/rt-error.log
    CustomLog ${APACHE_LOG_DIR}/rt-access.log combined
    AddDefaultCharset UTF-8
    DocumentRoot "/opt/rt4/share/html"
    RedirectMatch ^/(netways)?/?$ https://rt.netways.de
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/(netways)?/?$ https://%{HTTP_HOST}/ [R=301,L]
    <Location />
        Require all granted
        SetHandler modperl
        PerlResponseHandler Plack::Handler::Apache2
        PerlSetVar psgi_app /opt/rt4/sbin/rt-server
    </Location>
    <Perl>
        use Plack::Handler::Apache2;
        Plack::Handler::Apache2->preload("/opt/rt4/sbin/rt-server");
    </Perl>
</VirtualHost>
